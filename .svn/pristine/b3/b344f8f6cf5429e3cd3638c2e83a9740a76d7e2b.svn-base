"use strict";define(["require","select2","webuploader","yoValidate"],function(t,e,n,l){return Vue.component("import-excel",{template:'\n\t\t<div class="pull-right m-l-xs">\n <button class="btn btn-primary" @click="customerImport"><i class="fa fa-cloud-upload"></i> 导入客户</button>\n <button class="btn btn-success" @click="customerAdd"><i class="fa fa-plus"></i> 新增客户</button>\n <div style="height:0;overflow:hidden;width:0;">\n        <div class="col-sm-12 form" :id="boxId">\n            <div v-if="role==\'经理\'" class="form-group clearfix m-t-lg">\n                <label class="col-sm-12" for="">负责人</label>\n                <div class="col-sm-12">\n                    <select :id="selectId" style="width:100%">\n                    </select>\n                </div>\n            </div>\n\t\t\t<div class="form-group clearfix" :class="{\'text-center m-t-lg\' : (role!=\'经理\')}">\n                <label class="col-sm-12" for="">上传EXCEL</label>\n                <div class="col-sm-12">\n\t\t\t\t\t<div v-if="saleId==\'\'">请先选择负责人</div>\n                    <div v-show="uploadBox" :id="btnId"></div>\n                </div>\n            </div>\n        </div>\n\n\t\t<div class="col-sm-12 form form-horizontal m-t-sm" :id="addBox">\n            <div class="row">\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">客户名称<span class="text-danger">*</span>：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" @blur="checkName" data-validate="require" placeholder="客户名称" type="text" v-model="c.name" value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">联系人：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="联系人名称" v-model="c.linkmanName"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">手机：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="手机号码" v-model="c.linkmanMobilePhone"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">电话：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="电话号码" v-model="c.linkmanLandline"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">邮箱：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="邮箱" v-model="c.email"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">微信号：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="微信号" v-model="c.weChat"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">QQ号：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="QQ号" v-model="c.qq"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">注册资本：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="注册资本" v-model="c.zczb"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">成立日期：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="成立日期" v-model="c.clrq"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">所在省：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t <select style="width:100%" v-model="c.province" :id="provinceBox">\n\t\t\t\t\t\t\t\t\t\t\t\t<option value="">请选择</option>\n\t\t\t\t\t\t\t\t\t\t\t<option v-for="el in citys[\'省份\']"  :value="el.regionName">{{el.regionName}}</option>\n\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div><div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">所在市：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t<select style="width:100%" v-model="c.cityName" :id="cityBox">\n\t\t\t\t\t\t\t\t\t\t\t<option value="">请选择</option>\n\t\t\t\t\t\t\t\t\t\t<option v-for="el in citys_sub" :value="el.regionName">{{el.regionName}}</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">所在区：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t<select style="width:100%" v-model="c.area" :id="cityBox">\n\t\t\t\t\t\t\t\t\t\t\t<option value="">请选择</option>\n\t\t\t\t\t\t\t\t\t\t<option v-for="el in citys_sub1" :value="el.regionName">{{el.regionName}}</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">具体地址：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="具体地址" v-model="c.address"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div><div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">下次跟进时间：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t<input class="form-control" readonly="" @click="laydate($event)" placeholder="下次跟进时间" type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div><div class="col-md-12">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">备注：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<input class="form-control" placeholder="备注" v-model="c.content"  type="text"  value="">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-md-12" v-if="role==\'经理\'">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t\t<label class="col-sm-3 control-label">负责人<span class="text-danger">*</span>：</label>\n\t\t\t\t\t\t\t\t\t<div class="col-sm-9">\n\t\t\t\t\t\t\t\t\t\t<select :id="saleBox" class="form-control" v-model="saleId" data-validate="require">\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n        </div>\n    </div>\n\t</div>\n  ',props:["role"],data:function(){return{citys:{},api_saveSaleCustomer:"/saleCustomer/saveSaleCustomer",api_hasName:"/saleCustomer/hasName",saleId:"",init:0,btnId:"importExcelBtn"+Math.random().toString().split(".")[1],boxId:"importExcelBox"+Math.random().toString().split(".")[1],selectId:"selectBox"+Math.random().toString().split(".")[1],uploadBox:1,init_add:0,addBox:"addBox"+Math.random().toString().split(".")[1],provinceBox:"provinceBox"+Math.random().toString().split(".")[1],cityBox:"cityBox"+Math.random().toString().split(".")[1],saleBox:"saleBox"+Math.random().toString().split(".")[1],select2:{selectId:{},saleId:{},province:{},citye:{}},c:{name:"",linkmanName:"",linkmanMobilePhone:"",linkmanLandline:"",email:"",weChat:"",qq:"",province:"",cityName:"",address:"",xcgetTime:"",content:"",zczb:"",clrq:""}}},computed:{citys_sub:function(){var l=this.c.province,n=[],o=void 0;return $.each(this.citys["省份"],function(t,e){l==e.regionName&&(o=e.id)}),$.each(this.citys["市区"],function(t,e){o==e.parentId&&n.push(e)}),n},citys_sub1:function(){var l=this.c.province,n=this.c.cityName,o=[],a=void 0,s=void 0;return console.log(n),$.each(this.citys["省份"],function(t,e){l==e.regionName&&(a=e.id)}),$.each(this.citys["市区"],function(t,e){a==e.parentId&&n==e.regionName&&(s=e.id,console.log(s))}),$.each(this.citys["区"],function(t,e){s==e.parentId&&o.push(e)}),o}},created:function(){localStorage.citys&&(this.citys=JSON.parse(localStorage.citys)),localStorage.userInfo&&"经理"!=this.role&&(this.saleId=JSON.parse(localStorage.userInfo).list[0].USER_ID)},mounted:function(){},methods:{checkName:function(e){$.post(this.api_hasName,{name:this.c.name}).done(function(t){"error"==t.result?layer.msg("客户名称已存在,请检查重试"):"function"==typeof e&&e()})},customerImport:function(){var e=this;if(e.uploadBox=1,"经理"==this.role){e.uploadBox=0,e.init||(e.init=1,e.select2.selectId=$("#"+this.selectId).select2({placeholder:"请选择负责人",language:"zh-CN",ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(t){return{page:t.page||1,ROLE_ID:"b729e9334ad64c15a4e47d88b8c2638f,30b1487221464d369ca4c2462ccca920",data:{q:t.term||""}}},processResults:function(t,e){return e.page=e.page||1,$.each(t,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:t,pagination:{more:10==t.length}}},cache:!0},minimumInputLength:0}).on("change",function(){var t=this;e.saleId=this.value,console.log(e.saleId),e.saleId&&(e.uploadBox=1,Vue.nextTick(function(){e.saleId=t.value,e.initUploader(e.saleId)}))}));layer.open({type:1,title:"导入客户",content:$("#"+e.boxId),area:["400px","300px"],end:function(){e.saleId="",e.select2.selectId.val(null).trigger("change"),e.uploadBox=0}})}else layer.open({type:1,title:"导入客户",content:$("#"+e.boxId),area:["400px","180px"],success:function(){e.init||(e.init=1,e.initUploader())}})},customerAdd:function(){var e=this,t=layer.open({type:1,title:"新增客户",content:$("#"+e.addBox),area:["800px","600px"],btnAlign:"c",btn:"保存",success:function(){e.init_add||(e.init_add=1,e.select2.province=$("#"+e.provinceBox).select2().on("change",function(){e.c.province=this.value,Vue.nextTick(function(){e.select2.city.select2("destroy"),e.select2.city.select2().on("change",function(){e.c.cityName=this.value})})}),e.select2.city=$("#"+e.cityBox).select2().on("change",function(){e.c.cityName=this.value}),"经理"==e.role&&(e.select2.saleId=$("#"+e.saleBox).select2({placeholder:"请选择负责人",language:"zh-CN",ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(t){return{page:t.page||1,ROLE_ID:"b729e9334ad64c15a4e47d88b8c2638f,30b1487221464d369ca4c2462ccca920",data:{q:t.term||""}}},processResults:function(t,e){return e.page=e.page||1,$.each(t,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:t,pagination:{more:10==t.length}}},cache:!0},minimumInputLength:0}).on("change",function(){e.saleId=this.value,console.log(e.saleId)})))},yes:function(){e.save(function(){layer.close(t),window.parentFnc&&window.parentFnc(),layer.msg("新增客户成功")})},end:function(){for(var t in"经理"==e.role&&(e.saleId=""),e.select2.city.val(null).trigger("change"),e.select2.province.val(null).trigger("change"),e.c)Vue.set(e.c,t,"")}})},initUploader:function(t){var l=this;console.log(l.saleId),l.uploader?l.uploader.option("formData",{isKhgh:2,saleId:t||l.saleId||""}):(console.log(t),l.uploader=n.create({server:"/saleCustomer/importExcel.do",formData:{isKhgh:2,saleId:t||l.saleId||""},timeout:0,runtimeOrder:"html5",pick:{id:"#"+l.btnId,innerHTML:"导入客户"},resize:!1,fileNumLimit:10}),l.uploader.on("uploadSuccess",function(t,e){l.uploader.reset(),l.$parent.loading("close"),e.result?layer.alert("上传成功<br>以下项目有重复无法导入:<br>"+e.result,function(){window.parentFnc&&window.parentFnc()}):(layer.msg("上传成功"),setTimeout(function(){window.parentFnc&&window.parentFnc()},2e3))}),l.uploader.on("uploadStart",function(){l.$parent.loading()}),l.uploader.on("uploadError",function(t){layer.msg("上传出错")}),l.uploader.on("error",function(t){"Q_TYPE_DENIED"==t&&layer.msg("上传文件格式错误，请检查")}),l.uploader.on("uploadFinished",function(t,e){}),l.uploader.on("fileQueued",function(){l.uploader.upload()}))},save:function(l){var n=this;this.checkName(function(){var t=n;if(t.c.name)if(t.saleId){var e=t.c;e.saleId=t.saleId,$.post(t.api_saveSaleCustomer,e).done(function(t){l&&l()})}else layer.msg("请选择负责人");else layer.msg("请填写客户名称")})},laydate:function(l){function t(t,e){return l.apply(this,arguments)}return t.toString=function(){return l.toString()},t}(function(t,e){var l=this;laydate({vEvent:t,format:"YYYY-MM-DD",istime:!0,istoday:!0,choose:function(t){l.c.xcgetTime=t}})})}})});