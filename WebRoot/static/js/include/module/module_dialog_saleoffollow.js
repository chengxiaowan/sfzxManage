"use strict";define(["require"],function(n){return Vue.component("sale-follow",{template:'<div class="col-sm-12 form" id="follow-box">\n            <form class="m-t-sm row">\n                <div class="form-group col-sm-4">\n                    <select style="width:100%" v-model="type" class="form-control">\n                    <option v-if="dialogMode==1" selected value="">请选择跟进方式</option>\n                   <option  selected value="0">电话</option>\n               \t   <option v-if="dialogMode==1" value="1">QQ</option>\n                   <option v-if="dialogMode==1" value="2">微信</option>\n                   <option v-if="dialogMode==1" value="3">拜访</option>\n                   <option v-if="dialogMode==1" value="4">邮件</option>\n                   <option v-if="dialogMode==1" value="5">短信</option>\n                   <option v-if="dialogMode==1" value="6">其他</option>\n               </select>\n                </div>\n                <div class="form-group col-sm-12">\n                    <textarea class="form-control" style="resize:none" v-model="content" placeholder="跟进详情" rows="6" cols=""></textarea>\n                </div>\n                <div class="form-group col-sm-12">\n                    <div id="followFilesUploadBtn"></div>\n                </div>\n                <div class="form-group col-sm-12">\n\n                <table v-if="files.length" class="table table-bordered">\n                    <thead>\n                        <tr>\n                            <th>文件名</th>\n                            <th width="180">操作</th>\n</tr>\n                    </thead>\n                    <tbody>\n                        <tr v-for="(el,index) of files">\n                            <td>{{el.originalFilename}}</td>\n                            <td><a target="_blank" :href="el.url" class="btn btn-primary btn-sm">\n                            <i class="fa fa-eye"></i> 查看</a>\n                            <a @click="files_del(index)" target="_blank" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i> 删除</a></td>\n                        </tr>\n                    </tbody>\n                </table>\n                </div>\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">提醒谁看 : </label>\n                    <div class="col-xs-8">\n                    <select style="width:100%" v-model="remind" multiple class="form-control input-sm" id="remindWho">\n                    </select>\n                    </div>\n                </div>\n                \n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">客户名称 : </label>\n                    <div class="col-xs-8 " style="overflow:hidden;text-overflow:ellipsis;white-space: nowrap;">\n                   \t\t\t{{customerName}}\n                    </div>\n                </div>\n                <div class="form-group col-sm-6" style="clear: both;"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">重要程度 : </label>\n                    <div class="col-xs-8 star">\n                    <img class=" htz-star" src="/static/ui/img/10icon/x2.png" @click="xx(\'1\')"  style="width:24px;margin-right: 5px;cursor:pointer">\n                    <img class=" htz-star"  src="/static/ui/img/10icon/x2.png" @click="xx(\'2\')"  style="width:24px;margin-right: 5px;cursor:pointer">\n                    <img class=" htz-star"  src="/static/ui/img/10icon/x2.png" @click="xx(\'3\')"  style="width:24px;margin-right: 5px;cursor:pointer">\n                   \n                    </div>\n                </div>\n                \n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">跟进状态<span class="text-danger">*</span> : </label>\n                    <div class="col-xs-8">\n                                                    <select name="status" v-model="status" class="form-control">\n                                    <option value="">请选择</option>\n                                    <option value="0">未处理</option>\n                                    <option value="1">初步沟通</option>\n                                    <option value="2">无意向</option>\n                                    <option value="13">潜在客户</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'&&a" value="12">有意向存疑</option>\n                                    <option value="3">有意向</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="4">销售外访</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="5">客户来访</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="6">需求确定</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="7">方案/报价</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="8">谈判/合同</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="9">成交</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="10">暂时搁置</option>\n                                    <option v-if="role!=\'电销员工\'&& role!=\'电销主管\'" value="11">未成交</option>\n                                </select>\n                    </div>\n                </div>\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">联系人 : </label>\n                    <div class="col-xs-8">\n                    <input v-if="dialogMode==0" type="text" readonly v-model="linkmanName" class="form-control input-sm  p-r-0"  name="" value="">   \n                    <div v-show="dialogMode==1">\n                     <select style="width:100%" v-model="linkmanId" multiple class="form-control input-sm" id="linkmanId"></select>\n                    </div>\n                    </div>\n                </div>\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">下次跟进时间 : </label>\n                    <div class="col-xs-8">\n                    \n                    <input type="text" placeholder=\'请填写下次跟进时间\'  style="width: 100%;text-align: center;" readonly="readonly" class="form-control input-sm  p-r-0" v-model="nextTime" id="nextTime" />\n                    </div>\n                </div>\n            </form>\n        </div>\n \t\t\t\t ',props:["dialogMode","callId"],data:function(){return{role:localStorage.userRole||"",type:0,time:"",content:"",files:[],remind:[],status:"",customerId:"",customerName:"",linkmanName:"",linkmanId:[],nextTime:"",a:!1,select_init:0,score:0}},created:function(){},mounted:function(){var i=this;laydate.render({elem:"#nextTime",type:"datetime",min:i.minDate(),done:function(t,e){i.nextTime=t}})},methods:{init:function(t,e){console.log(this.dialogMode),console.log(t,t.h),1==this.dialogMode?this.type="":this.type=0,1==t.h&&(this.a=!0),null==t.h&&1==t.type&&(this.a=!0),0==t.score?(this.score=0,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png")):1==t.score?(this.score=1,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png")):2==t.score?(this.score=2,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png")):3==t.score&&(this.score=3,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x1.png")),null==t.score&&0==t.score?(this.score=0,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png")):null==t.score&&1==t.score?(this.score=1,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png")):null==t.score&&2==t.score?(this.score=2,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png")):null==t.score&&3==t.score&&(this.score=3,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x1.png")),t&&(this.customerId=t.id||"",this.customerName=t.name||"",this.linkmanName=e||t.linkmanName||"");var i=this;layer.open({scrollbar:!0,type:"1",title:"写跟进",content:$("#follow-box"),area:["700px","620px"],btn:["保存"],btnAlign:"c",yes:function(){i.save()},end:function(){i.remindWhoBox.val(null).trigger("change"),i.linkmanBox.val(null).trigger("change"),i.content="",window.callId="",i.files=[],i.remind=[],i.status="",i.customerId="",i.customerName="",i.linkmanName="",i.linkmanId=[],i.nextTime="",i.score=0,$(".htz-star").eq(0).removeClass("active"),$(".htz-star").eq(1).removeClass("active"),$(".htz-star").eq(2).removeClass("active")},success:function(){i.select_init||(i.remindWhoBox=$("#remindWho").select2({placeholder:"请选择",language:"zh-CN",allowClear:!0,ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(t){return{page:t.page||1,ROLE_ID:"7d2f882f13ea48e0a4c8acaeea53b3a5,30b1487221464d369ca4c2462ccca920,01dc6d29f1704efeab0376d327f47d98,90564dd8b75a4f6d815ce418462d401c,e350acd05a6244c79136616302b7dfd6,b729e9334ad64c15a4e47d88b8c2638f,008615f04f39499fb73e5f323add988a,6f247fed28e94194ac66020e55957496,28f1842e2463492a9eb6ddf0def91658,73340766cf3d43af91daff3128adad84,b62d6d19bed64ee199f2c1a5b252b57b,04fe5e23842f4b998216080bc3b61821,4cb60182bb294cfba622f951e390bc6f ",data:{q:t.term||""}}},processResults:function(t,e){return e.page=e.page||1,$.each(t,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:t,pagination:{more:10==t.length}}},cache:!0},minimumInputLength:0}).on("change",function(){i.remind=[];for(var t=0;t<this.children.length;t++)this.children[t].selected&&i.remind.push(this.children[t].value)}),i.linkmanBox=$("#linkmanId").select2({placeholder:"请选择",language:"zh-CN",allowClear:!0,ajax:{url:"/linkman/getLinkmanInfo",dataType:"json",type:"post",delay:250,data:function(t){return{page:t.page||1,data:{q:t.term||""},id:i.customerId,type:3}},processResults:function(t,e){return e.page=e.page||1,$.each(t,function(){this.id=this.linkmanName,this.text=this.linkmanName}),{results:t,pagination:{more:10==t.length}}},cache:!0},minimumInputLength:0}).on("change",function(){i.linkmanId=[];for(var t=0;t<this.children.length;t++)this.children[t].selected&&i.linkmanId.push(this.children[t].value)}),i.select_init=1,i.$parent.loading(),n(["webuploader"],function(t){app.loading("close");var e=t.create({server:"/contract/uploadAttachment.do",runtimeOrder:"html5",pick:{id:"#followFilesUploadBtn",innerHTML:"上传附件"},resize:!1,fileNumLimit:10});e.on("uploadSuccess",function(t,e){i.files.push(e)}),e.on("uploadStart",function(){i.$parent.loading()}),e.on("uploadError",function(t){layer.msg("上传出错")}),e.on("error",function(t){"Q_TYPE_DENIED"==t&&layer.msg("上传文件格式错误，请检查")}),e.on("uploadFinished",function(t){e.reset(),i.$parent.loading("close")}),e.on("fileQueued",function(){e.upload()})}))}})},loading:function(t){"close"==t?layer.close(this.loadingSwitch):this.loadingSwitch=layer.load(3)},save:function(){var e=this;if(console.log(e.score),top.callId||0!=this.dialogMode)if(""!==this.status)if(""!==this.type){if((new Date).getTime()>new Date(this.nextTime).getTime())return layer.msg("不能小于当前时间"),!1;if(3!=this.status&&4!=this.status&&5!=this.status&&6!=this.status&&7!=this.status&&8!=this.status||0!=this.score){var t={content:this.content,files:this.files,remind:this.remind,status:this.status,customerId:this.customerId,nextTime:this.nextTime,customerName:this.customerName,score:this.score};0==this.dialogMode&&(t.callId=top.callId),this.linkmanName?(t.linkmanId=[],t.linkmanId.push(this.linkmanName)):t.linkmanId=this.linkmanId,t.type=this.type,e.loading(),yocto.json("/saleCustomer/saveProcessInfo",t,function(t){layer.msg("销售动态保存成功"),layer.closeAll(),e.$parent&&e.$parent.getCaseDetail&&e.$parent.getCaseDetail(),e.$parent&&e.$parent.getCaseRecord&&e.$parent.getCaseRecord(),window.parentFnc&&window.parentFnc()})}else layer.msg("请勾选重要程度")}else layer.msg("请选择跟进方式");else layer.msg("请选择跟进状态");else layer.msg("请挂断电话之后再保存记录")},files_del:function(t){var e=this,i=layer.confirm("确认删除此项?",function(){e.files.splice(t,1),layer.close(i)})},laydate:function(n){function t(t,e,i){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t}(function(t,e,i){var n=this;laydate({vEvent:t,format:"YYYY-MM-DD hh:mm:ss",istime:!0,istoday:!0,choose:function(t){i?n.time=t:n.nextTime=t}})}),minDate:function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},xx:function(t){var e=this;console.log(t),1==t?"/static/ui/img/10icon/x2.png"==$(".htz-star").eq(0).attr("src")?($(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png"),e.score=1):"/static/ui/img/10icon/x1.png"==$(".htz-star").eq(1).attr("src")||"/static/ui/img/10icon/x1.png"==$(".htz-star").eq(2).attr("src")?($(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png"),e.score=1):($(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x2.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png"),e.score=0):2==t?(e.score=2,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x2.png")):3==t&&(e.score=3,$(".htz-star").eq(0).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(1).attr("src","/static/ui/img/10icon/x1.png"),$(".htz-star").eq(2).attr("src","/static/ui/img/10icon/x1.png"))}}})});