"use strict";define(["require"],function(l){return Vue.component("sale-follow1",{template:'<div class="col-sm-12 form" id="follow-box">\n            <form class="m-t-sm row">\n                <div class="form-group col-sm-4">\n                    <select style="width:100%" v-model="type" class="form-control">\n                    <option v-if="dialogMode==1" selected value="">请选择跟进方式</option>\n                   <option  selected value="0">电话</option>\n                   \n               \t   <option v-if="dialogMode==1" value="1">QQ</option>\n                   <option v-if="dialogMode==1" value="2">微信</option>\n                   <option v-if="dialogMode==1" value="3">拜访</option>\n                   <option v-if="dialogMode==1" value="4">邮件</option>\n                   <option v-if="dialogMode==1" value="5">短信</option>\n                   <option v-if="dialogMode==1" value="6">其他</option>\n               </select>\n                </div>\n                <div class="form-group col-sm-12">\n                    <textarea class="form-control" style="resize:none" v-model="content" placeholder="跟进详情" rows="6" cols=""></textarea>\n                </div>\n                <div class="form-group col-sm-12">\n                    <div id="followFilesUploadBtn"></div>\n                </div>\n                <div class="form-group col-sm-12">\n\n                <table v-if="files.length" class="table table-bordered">\n                    <thead>\n                        <tr>\n                            <th>文件名</th>\n                            <th width="180">操作</th>\n</tr>\n                    </thead>\n                    <tbody>\n                        <tr v-for="(el,index) of files">\n                            <td>{{el.originalFilename}}</td>\n                            <td><a target="_blank" :href="el.url" class="btn btn-primary btn-sm">\n                            <i class="fa fa-eye"></i> 查看</a>\n                            <a @click="files_del(index)" target="_blank" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i> 删除</a></td>\n                        </tr>\n                    </tbody>\n                </table>\n                </div>\n                <div class="form-group col-sm-12"> \n                    <label class="control-label col-xs-2 p-l-0 p-r-0" for="">提醒谁看 : </label>\n                    <div class="col-xs-10">\n                    <select style="width:100%" v-model="remind" multiple class="form-control input-sm" id="remindWho">\n                    </select>\n                    </div>\n                </div>\n\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">联系人 : </label>\n                    <div class="col-xs-8">\n                    <input v-if="dialogMode==0" type="text" readonly v-model="linkmanName" class="form-control input-sm  p-r-0"  name="" value="">   \n                    <div v-show="dialogMode==1">\n                     <select style="width:100%" v-model="linkmanId" multiple class="form-control input-sm" id="linkmanId"></select>\n                    </div>\n                    </div>\n                </div>\n                <div class="form-group col-sm-6"> \n                    <label class="control-label col-xs-4 p-l-0 p-r-0" for="">下次跟进时间 : </label>\n                    <div class="col-xs-8">\n                    <input type="text" placeholder=\'请填写下次跟进时间\'  style="width: 100%;text-align: center;" readonly="readonly" class="form-control input-sm  p-r-0" v-model="nextTime" id="nextTime" />\n                    </div>\n                </div>\n            </form>\n        </div>\n \t\t\t\t ',props:["dialogMode","callId"],data:function(){return{role:localStorage.userRole||"",type:0,time:"",content:"",files:[],remind:[],status:"",customerId:"",customerName:"",linkmanName:"",linkmanId:[],nextTime:"",select_init:0}},created:function(){},mounted:function(){var t=this;laydate.render({elem:"#nextTime",type:"datetime",done:function(e,n){t.nextTime=e}})},methods:{init:function(e,n){console.log(this.dialogMode),1==this.dialogMode?this.type="":this.type=0,e&&(this.customerId=e.id||"",this.customerName=e.name||"",this.linkmanName=n||e.linkmanName||"");var t=this;layer.open({scrollbar:!0,type:"1",title:"写跟进",content:$("#follow-box"),area:["700px","620px"],btn:["保存"],btnAlign:"c",yes:function(){t.save()},end:function(){t.remindWhoBox.val(null).trigger("change"),t.linkmanBox.val(null).trigger("change"),t.content="",window.callId="",t.files=[],t.remind=[],t.status="",t.customerId="",t.customerName="",t.linkmanName="",t.linkmanId=[],t.nextTime=""},success:function(){t.select_init||(t.remindWhoBox=$("#remindWho").select2({placeholder:"请选择",language:"zh-CN",allowClear:!0,ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(e){return{page:e.page||1,ROLE_ID:"7d2f882f13ea48e0a4c8acaeea53b3a5,30b1487221464d369ca4c2462ccca920,01dc6d29f1704efeab0376d327f47d98,90564dd8b75a4f6d815ce418462d401c,e350acd05a6244c79136616302b7dfd6,b729e9334ad64c15a4e47d88b8c2638f,008615f04f39499fb73e5f323add988a,6f247fed28e94194ac66020e55957496,28f1842e2463492a9eb6ddf0def91658,73340766cf3d43af91daff3128adad84,b62d6d19bed64ee199f2c1a5b252b57b,04fe5e23842f4b998216080bc3b61821,4cb60182bb294cfba622f951e390bc6f ",data:{q:e.term||""}}},processResults:function(e,n){return n.page=n.page||1,$.each(e,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:e,pagination:{more:10==e.length}}},cache:!0},minimumInputLength:0}).on("change",function(){t.remind=[];for(var e=0;e<this.children.length;e++)this.children[e].selected&&t.remind.push(this.children[e].value)}),t.linkmanBox=$("#linkmanId").select2({placeholder:"请选择",language:"zh-CN",allowClear:!0,ajax:{url:"/linkman/getLinkmanInfo",dataType:"json",type:"post",delay:250,data:function(e){return{page:e.page||1,data:{q:e.term||""},id:t.customerId,type:0}},processResults:function(e,n){return n.page=n.page||1,$.each(e,function(){this.id=this.linkmanName,this.text=this.linkmanName}),{results:e,pagination:{more:10==e.length}}},cache:!0},minimumInputLength:0}).on("change",function(){t.linkmanId=[];for(var e=0;e<this.children.length;e++)this.children[e].selected&&t.linkmanId.push(this.children[e].value)}),t.select_init=1,t.$parent.loading(),l(["webuploader"],function(e){app.loading("close");var n=e.create({server:"/contract/uploadAttachment.do",runtimeOrder:"html5",pick:{id:"#followFilesUploadBtn",innerHTML:"上传附件"},resize:!1,fileNumLimit:10});n.on("uploadSuccess",function(e,n){t.files.push(n)}),n.on("uploadStart",function(){t.$parent.loading()}),n.on("uploadError",function(e){layer.msg("上传出错")}),n.on("error",function(e){"Q_TYPE_DENIED"==e&&layer.msg("上传文件格式错误，请检查")}),n.on("uploadFinished",function(e){n.reset(),t.$parent.loading("close")}),n.on("fileQueued",function(){n.upload()})}))}})},save:function(){var n=this;if(top.callId||0!=this.dialogMode)if(""!==this.type){var e={content:this.content,files:this.files,remind:this.remind,customerId:this.customerId,nextTime:this.nextTime,customerName:this.customerName};0==this.dialogMode&&(e.callId=top.callId),this.linkmanName?(e.linkmanId=[],e.linkmanId.push(this.linkmanName)):e.linkmanId=this.linkmanId,e.type=this.type,yocto.json("/customer/saveProcessInfo",e,function(e){layer.closeAll(),layer.msg("商务顾问动态保存成功"),n.$parent&&n.$parent.getCaseRecord&&n.$parent.getCaseRecord(),window.parentFnc&&window.parentFnc()})}else layer.msg("请选择跟进方式");else layer.msg("请挂断电话之后再保存记录")},files_del:function(e){var n=this,t=layer.confirm("确认删除此项?",function(){n.files.splice(e,1),layer.close(t)})},laydate:function(l){function e(e,n,t){return l.apply(this,arguments)}return e.toString=function(){return l.toString()},e}(function(e,n,t){var l=this;laydate({vEvent:e,format:"YYYY-MM-DD hh:mm:ss",istime:!0,istoday:!0,choose:function(e){t?l.time=e:l.nextTime=e}})})}})});