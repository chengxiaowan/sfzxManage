"use strict";var config={isKhGh:yo.getQueryString("isKhGh")||0,role:localStorage.userRole,api_detail:"/main/showdfSaleProcessDetail.do",time:yo.getQueryString("time"),id:yo.getQueryString("id"),saleName:yo.getQueryString("saleName"),api_user:"/user/getUserInfo"};"销售精英"!=config.role&&"经理"!=config.role||(config.isKhGh=4);var dxOnly={title:{text:"",textStyle:{color:"#3a3a3a",fontStyle:"normal",fontSize:18}},tooltip:{trigger:"axis"},legend:{data:["电话量","意向客户数"]},grid:{x:40,x2:40},xAxis:[{type:"category",data:["四月","五月","六月","七月","八月","九月","十月","十一月","十二月","一月","二月","三月"]}],yAxis:[{type:"value",name:"电话量",position:"left"},{type:"value",name:"意向客户数",position:"right"}],series:[{name:"电话量",type:"bar",data:[],barWidth:10,itemStyle:{normal:{color:"#459df5"}}},{name:"意向客户数",type:"bar",yAxisIndex:1,data:[],barWidth:10,itemStyle:{normal:{color:"#53c1a6"}}}]},pieChartOption={title:{x:"center"},toolbox:{show:!1,feature:{restore:{show:!1},saveAsImage:{show:!1}}},tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:[{name:"电话量",center:["50%","60%"],radius:"90%",axisLine:{lineStyle:{color:[[.3,"#ff878e"],[.8,"#ffce89"],[1,"#5bd4d1"]],width:10}},axisTick:{length:15,lineStyle:{color:"auto"}},splitLine:{length:20,lineStyle:{color:"auto"}},pointer:{width:3},type:"gauge",z:3,min:0,max:220,splitNumber:10,detail:{formatter:"{value}%"},data:[{value:45,name:"电话量",label:{textStyle:{fontSize:16}}}]}]},pieChartOption2={title:{x:"center"},toolbox:{show:!1,feature:{restore:{show:!1},saveAsImage:{show:!1}}},tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:[{name:"意向客户数",center:["50%","60%"],radius:"90%",axisLine:{lineStyle:{color:[[.3,"#ff878e"],[.8,"#ffce89"],[1,"#5bd4d1"]],width:10}},axisTick:{length:15,lineStyle:{color:"auto"}},splitLine:{length:20,lineStyle:{color:"auto"}},pointer:{width:3},type:"gauge",z:3,min:0,max:220,splitNumber:10,detail:{formatter:"{value}%"},data:[{value:45,name:"意向客户数",label:{textStyle:{fontSize:16}}}]}]};require(["select2"],function(e){window.app=new Vue({el:"#app",data:{dxmonth:config.time.split("-")[0],dx:{dhl:"",mbdhl:"",yxkhs:"",mbyxkhs:"",list:[]},saleId:config.id,listId:[],idchange:"",sjbt:"",a:"",b:"",c:"",d:""},watch:{dxmonth:function(e){this.getDataDx(e,this.saleId,1)},saleId:function(e){this.getDataDx(this.dxmonth,e,2)}},computed:{},created:function(){document.getElementById("app").classList.remove("hide")},mounted:function(){var a=this;laydate.render({elem:"#dxmonth",type:"year",done:function(e,t){a.dxmonth=e}}),this.getDataDx(this.dxmonth,config.id),this.getUser()},methods:{loading:function(e){"close"==e?layer.close(this.loadingSwitch):this.loadingSwitch=layer.load(3)},getUser:function(){var t=this;t.loading(),$.ajax({type:"post",url:config.api_user,async:!0,data:{ROLE_ID:"7d2f882f13ea48e0a4c8acaeea53b3a5,30b1487221464d369ca4c2462ccca920,01dc6d29f1704efeab0376d327f47d98"},success:function(e){t.loading("close"),t.listId=e}})},getDataDx:function(e,r,h){var c,x,m,y,p=this,u=p.nowMonth(),f=u;p.loading(),$.ajax({url:config.api_detail,async:!0,data:{startTime:e+"-04-01",endTime:Number(e)+1+"-03-31",saleId:r},success:function(e){if(p.loading("close"),"00"==e.error){p.dx.list=e.result;for(var t=[],a=[],i=0;i<e.result.length;i++){0==(l=e.result[i]).mbyxkhs&&(l.mbyxkhs="0,0"),t.push(l.dhl),a.push(l.yxkhs||0)}if(null==h)for(i=0;i<e.result.length;i++){var l=e.result[i];u==l.time&&(p.idchange=i,p.dx.dhl=l.dhl||0,p.dx.mbdhl=l.mbdhl||0,p.dx.yxkhs=l.yxkhs||0,p.dx.mbyxkhs=l.mbyxkhs.split(",")[0]||0,"Infinity"==(c=Math.round(l.dhl/l.mbdhl*1e4)/100)?c=100:isNaN(c)&&(c=0),100<=c&&(c=100),x=c+"%","Infinity"==(m=Math.round(l.yxkhs/l.mbyxkhs.split(",")[0]*1e4)/100)?m=100:isNaN(m)&&(m=0),100<=m&&(m=100),y=m+"%",p.dxhx(c,x,m,y,f,r))}else if(1==h||2==h){var n=e.result[p.idchange].time;p.dx.dhl=e.result[p.idchange].dhl||0,p.dx.mbdhl=e.result[p.idchange].mbdhl||0,p.dx.yxkhs=e.result[p.idchange].yxkhs||0,p.dx.mbyxkhs=e.result[p.idchange].mbyxkhs.split(",")[0]||0,"Infinity"==(c=Math.round(p.dx.dhl/p.dx.mbdhl*1e4)/100)?c=100:isNaN(c)&&(c=0),100<=c&&(c=100),x=c+"%","Infinity"==(m=Math.round(p.dx.yxkhs/p.dx.mbyxkhs.split(",")[0]*1e4)/100)?m=100:isNaN(m)&&(m=0),100<=m&&(m=100),y=m+"%",p.dxhx(c,x,m,y,n,r)}var s=Number(Math.max.apply(null,t));s+=.2*s;var o=Number(Math.max.apply(null,a));o+=o;var d=echarts.init(document.getElementById("dxOnly"));dxOnly.series[0].data=t,dxOnly.series[1].data=a,dxOnly.yAxis[0].max=Math.ceil(s),dxOnly.yAxis[1].max=Math.ceil(o),d.setOption(dxOnly),d.off("click"),d.on("click",function(e){if(0==e.seriesIndex||1==e.seriesIndex){f=p.dx.list[e.dataIndex].time;var t=p.dx.list[e.dataIndex];p.dx.dhl=t.dhl||0,p.dx.mbdhl=t.mbdhl||0,p.dx.yxkhs=t.yxkhs||0,p.dx.mbyxkhs=t.mbyxkhs.split(",")[0]||0,c=Math.round(t.dhl/t.mbdhl*1e4)/100,console.log(c),"Infinity"==c?c=100:isNaN(c)&&(c=0),100<=c&&(c=100),x=c+"%","Infinity"==(m=Math.round(t.yxkhs/t.mbyxkhs.split(",")[0]*1e4)/100)?m=100:isNaN(m)&&(m=0),100<=m&&(m=100),y=m+"%",p.dxhx(c,x,m,y,f,r)}})}else layer.msg(e.msg)}})},dxhx:function(e,t,a,i,l,n){var s=this,o=l.split("-"),d=o[0],r=o[1],h=new Date(d,r,0).getDate();t0=l+"-01",t1=l+"-"+h,pieChartOption.series[0].max="100",pieChartOption.series[0].data[0].value=e,pieChartOption.title.text=l+"月份";var c=document.getElementById("pie"),x=echarts.init(c);s.a=t0,s.b=t1,s.c=n,s.d=config.saleName,x.setOption(pieChartOption),x.off("click"),x.on("click",function(e){var t="/static/page/index/saler_follow_list.html?startTime="+t0+"&endTime="+t1+"&type=1&saleId="+n+"&saleName="+config.saleName;layer.open({type:2,title:"电话量",content:t,area:["100%","100%"]})}),pieChartOption2.series[0].max="100",pieChartOption2.series[0].data[0].value=a,pieChartOption2.title.text=l+"月份";var m=document.getElementById("pie2"),y=echarts.init(m);y.setOption(pieChartOption2),y.off("click"),y.on("click",function(e){layer.open({type:2,title:"意向客户数",content:"/static/page/index/saler_customer_list.html?startTime="+t0+"&endTime="+t1+"&saleId="+n+"&saleName="+config.saleName,area:["100%","100%"]})})},dx_location:function(e){var t=this;if("1"==e){var a="/static/page/index/saler_follow_list.html?startTime="+t.a+"&endTime="+t.b+"&type=1&saleId="+t.c+"&saleName="+t.d;layer.open({type:2,title:"电话量",content:a,area:["100%","100%"]})}else layer.open({type:2,title:"查看详情",content:"/static/page/index/saler_customer_list.html?startTime="+t.a+"&endTime="+t.b+"&saleId="+t.c+"&saleName="+t.d,area:["100%","100%"]})},nowMonth:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1;return a=a<10?"0"+a:a,t.toString()+"-"+a.toString()}}})}),window.parentFnc=function(e){layer.closeAll(),window.app.getCaseRecord(window.app.type)};