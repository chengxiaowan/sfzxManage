"use strict";var config={role:localStorage.userRole,power:localStorage.power,api_showSaleCustomer:"/saleCustomer/showSaleCustomer",api_qdKhgh:"/saleCustomer/qdKhgh",api_import:"/saleCustomer/importExcel.do",api_moveGh:"/saleCustomer/moveGh.do",api_moveKh:"/saleCustomer/moveKh.do",api_call:"/saleCustomer/call.do",api_hasName:"/saleCustomer/hasName",api_updateSaleCustomer:"/saleCustomer/updateSaleCustomer"};require(["module_dialog_saleoffollow","module_dialog_importExcel"],function(e,t){window.app=new Vue({el:"#app",data:{c:{},role:config.role,power:config.power,isKhGh:2,postData:{},posting:!1,checkAll:0,checks:[],callId:"",s:{keywords:{},saleName:{},provinceName:"",cityName:"",areaName:""},sort:{gjTime:"",clrq:"",xchrghTime:"",zczb:""},select2:{},hoverEl:{name:{show:0,el:{}},linkmanLandline:{show:0,el:{}},linkmanMobilePhone:{show:0,el:{}},email:{},postion:{show:0,el:{}},linkmanName:{show:0,el:{}},remark:{show:0,el:{}}},editEl:{show:"",el:{},oldValue:""},saleFollowMode:0,citys_sub:[],citys_sub1:[]},watch:{"s.provinceName":{handler:function(){var i=this.s.provinceName,a=[],o=void 0;console.log(i),$.each(this.citys["省份"],function(e,t){i==t.regionName&&(o=t.id)}),$.each(this.citys["市区"],function(e,t){o==t.parentId&&a.push(t)}),this.citys_sub=a,Vue.set(this.citys_sub)},deep:!0},"s.cityName":{handler:function(){var i=this.s.provinceName,a=this.s.cityName,o=[],s=void 0,c=void 0;console.log(a),$.each(this.citys["省份"],function(e,t){i==t.regionName&&(s=t.id)}),$.each(this.citys["市区"],function(e,t){s==t.parentId&&a==t.regionName&&(c=t.id,console.log(c))}),$.each(this.citys["区"],function(e,t){c==t.parentId&&o.push(t)}),this.citys_sub1=o,Vue.set(this.citys_sub1)},deep:!0}},computed:{},created:function(){document.getElementById("app").classList.remove("hide"),localStorage.citys&&(this.citys=JSON.parse(localStorage.citys))},mounted:function(){var i=this;this.list_Get(),this.$watch("checks",function(e,t){i.checks.length==i.c.list.length?i.checkAll=1:i.checkAll=0}),$(".select2").select2({language:"zh-CN"}),this.select2.province=$("select[name=provinceName]").select2({language:"zh-CN",placeholder:"请选择",allowClear:1}).on("change",function(){i.s.provinceName=this.value,i.select2.city.val(null).trigger("change")}),i.select2.city=$("select[name=cityName]").select2({language:"zh-CN",placeholder:"请选择",allowClear:1}).on("change",function(){i.s.cityName=this.value,i.select2.area.val(null).trigger("change")}),i.select2.area=$("select[name=area]").select2({language:"zh-CN",placeholder:"请选择",allowClear:1}).on("change",function(){i.s.areaName=this.value}),"经理"!=i.role&&"电销主管"!=this.role||(i.s.saleName=i.select_init("[name=saleName]","请选择负责人",1));i.select_init("#salerId");require(["webuploader"],function(e){var t=e.create({server:config.api_import,formData:{isKhgh:0},runtimeOrder:"html5",pick:{id:"#excel_fileUp",innerHTML:"导入客户"},resize:!1,fileNumLimit:10});t.on("uploadSuccess",function(e,t){}),t.on("uploadStart",function(){i.loading()}),t.on("uploadError",function(e){layer.msg("上传出错")}),t.on("error",function(e){"Q_TYPE_DENIED"==e&&layer.msg("上传文件格式错误，请检查")}),t.on("uploadFinished",function(e){t.reset(),layer.msg("上传成功"),i.loading("close"),i.list_Get()}),t.on("fileQueued",function(){t.upload()})})},directives:{focus:{inserted:function(e){e.focus(),e.dataset.tips&&layer.yoTips('<span style="color:#337ab7">'+e.dataset.tips+"</span>",e,{tips:[2,"#fff"]})}}},methods:{clear:function(){"经理"!=this.role&&"电销主管"!=this.role||this.s.saleName.val(null).trigger("change"),this.select2.province.val(null).trigger("change"),this.select2.city.val(null).trigger("change"),this.select2.area.val(null).trigger("change")},btn_checkAll:function(){var e=this;e.checks=[],e.checkAll&&$.each(e.c.list,function(){e.checks.push(this.id)})},edit_hover:function(e,t){Vue.set(this.hoverEl,e,{show:1,el:t})},edit_el:function(e,t){this.editEl.show=e,this.editEl.el=t,this.editEl.oldValue=t.name},edit_submit:function(e,t){console.log(2),this.editEl.show="",this.editEl.el={},Vue.set(this.hoverEl,e,{show:0,el:{}}),this.saveData(e,t)},edit_keyup:function(e,t){this.editEl.show="",this.editEl.el={},Vue.set(this.hoverEl,e,{show:0,el:{}})},overTips:function(e){layer.yoTips('<span style="color:#337ab7">'+e.remark+"</span>","#remark_"+e.id,{tips:[2,"#fff"]})},saveData:function(t,i){var a=this;function o(){var e={id:i.id};e[t]=$.trim(i[t]),$.post(config.api_updateSaleCustomer,e,function(e){})}"name"!=t||""!=i.name?"name"==t&&i.name==this.editEl.oldValue||("name"==t?$.post(config.api_hasName,{name:$.trim(i.name)}).done(function(e){if("error"==e.result)return layer.msg("客户名称已存在,请检查重试"),void(i.name=a.editEl.oldValue);o()}):o()):i.name=this.editEl.oldValue},loading:function(e){"close"==e?layer.close(this.loadingSwitch):this.loadingSwitch=layer.load(3)},search:function(){this.postData.keywords=$.trim($("[name=keywords]").val()),this.postData.saleName=$.trim($("[name=saleName]").val()),this.postData.cityName=$.trim($("[name=cityName]").val()),this.postData.provinceName=$.trim($("[name=provinceName]").val()),this.postData.area=$.trim($("[name=area]").val()),this.postData.status=$("[name=status]").val(),this.postData.cusRes=$("[name=cusRes]").val(),this.list_Get(1)},list_Get:function(t){$(".appWrapper").scrollTop(0),this.checks=[];var i=this;t&&(this.c.pageNum=t),i.loading(),i.postData.isKhGh=this.isKhGh,i.postData.pageSize=this.c.pageSize,i.postData.pageNo=this.c.pageNum,i.postData.gjTime=this.sort.gjTime,i.postData.clrq=this.sort.clrq,i.postData.xchrghTime=this.sort.xchrghTime,$.ajax({url:config.api_showSaleCustomer,async:!1,data:i.postData}).done(function(e){i.c=e.result,i.pagi?($(".pagi").pagination("updatePages",i.c.pages),1==t&&$(".pagi").pagination("goToPage",i.c.pageNum)):require(["pagination"],function(e){i.pagi=$(".pagi").pagination({pages:i.c.pages,showCtrl:!0,displayPage:6,currentPage:i.c.pageNum,onSelect:function(e){i.c.pageNum=e,i.list_Get()}})}),i.loading("close")})},data_sort:function(e){switch(this.sort[e]){case"":Vue.set(this.sort,e,0);break;case 0:Vue.set(this.sort,e,1);break;case 1:Vue.set(this.sort,e,"")}for(var t in this.sort)t!=e&&Vue.set(this.sort,t,"");this.list_Get(1)},shiftToOther:function(){var t=this;if(this.checks.length)var i=layer.open({type:1,title:"转移客户",closeBtn:1,content:$("#salerBox"),area:["350px","200px"],btn:"转移",btnAlign:"c",yes:function(){$("#salerId").val()?yocto.json(config.api_moveKh,{id:t.checks,saleId:$("#salerId").val()},function(e){layer.close(i),layer.msg("转移成功"),t.checks=[],t.list_Get(1)}):layer.close(i)}});else layer.msg("请先选择一项进行操作")},shiftToSea:function(){var t=this;if(this.checks.length)if("经理"==this.role||"高级商务顾问S2"==this.role||"高级商务顾问S3"==this.role||"电销商务顾问"==this.role)var i=layer.confirm("请选择转移到的公海",{btn:["有意向公海","客户公海","大客户公海","无意向公海","新三板公海","上市公司公海"],btnAlign:"c",btn3:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:4},function(e){layer.msg("转移成功"),layer.close(i),t.btn_checkAll(),t.list_Get(1)})},btn4:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:1},function(e){layer.msg("转移成功"),layer.close(i),t.btn_checkAll(),t.list_Get(1)})},btn5:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:7},function(e){layer.msg("转移成功"),layer.close(i),t.btn_checkAll(),t.list_Get(1)})},btn6:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:6},function(e){layer.msg("转移成功"),layer.close(i),t.btn_checkAll(),t.list_Get(1)})}},function(){var a=0;$.each(t.checks,function(e,i){$.each(t.c.list,function(e,t){t.id==i&&3<=t.gjStatus&&t.gjStatus<10&&a++})}),a?yocto.json(config.api_moveGh,{id:t.checks,isKhgh:3},function(e){layer.msg("转移成功"),layer.close(i),t.btn_checkAll(),t.list_Get(1)}):layer.alert("只有[有意向]及以上的跟进状态客户可以转入[有意向公海],请检查选择项")},function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:0},function(e){layer.msg("转移成功"),layer.close(i),t.btn_checkAll(),t.list_Get(1)})});else if("高级商务顾问S1"==this.role)var o=layer.confirm("请选择转移到的公海",{btn:["有意向公海","客户公海","大客户公海","无意向公海","新三板公海"],btnAlign:"c",btn3:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:4},function(e){layer.msg("转移成功"),layer.close(o),t.btn_checkAll(),t.list_Get(1)})},btn4:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:1},function(e){layer.msg("转移成功"),layer.close(o),t.btn_checkAll(),t.list_Get(1)})},btn5:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:7},function(e){layer.msg("转移成功"),layer.close(o),t.btn_checkAll(),t.list_Get(1)})}},function(){var a=0;$.each(t.checks,function(e,i){$.each(t.c.list,function(e,t){t.id==i&&3<=t.gjStatus&&t.gjStatus<10&&a++})}),a?yocto.json(config.api_moveGh,{id:t.checks,isKhgh:3},function(e){layer.msg("转移成功"),layer.close(o),t.btn_checkAll(),t.list_Get(1)}):layer.alert("只有[有意向]及以上的跟进状态客户可以转入[有意向公海],请检查选择项")},function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:0},function(e){layer.msg("转移成功"),layer.close(o),t.btn_checkAll(),t.list_Get(1)})});else if("商务顾问J"==this.role||"商务助理"==this.role)var s=layer.confirm("请选择转移到的公海",{btn:["有意向公海","客户公海","大客户公海","无意向公海"],btnAlign:"c",btn3:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:4},function(e){layer.msg("转移成功"),layer.close(s),t.btn_checkAll(),t.list_Get(1)})},btn4:function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:1},function(e){layer.msg("转移成功"),layer.close(s),t.btn_checkAll(),t.list_Get(1)})}},function(){var a=0;$.each(t.checks,function(e,i){$.each(t.c.list,function(e,t){t.id==i&&3<=t.gjStatus&&t.gjStatus<10&&a++})}),a?yocto.json(config.api_moveGh,{id:t.checks,isKhgh:3},function(e){layer.msg("转移成功"),layer.close(s),t.btn_checkAll(),t.list_Get(1)}):layer.alert("只有[有意向]及以上的跟进状态客户可以转入[有意向公海],请检查选择项")},function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:0},function(e){layer.msg("转移成功"),layer.close(s),t.btn_checkAll(),t.list_Get(1)})});else var a=layer.confirm("请选择转移到的公海",{btn:["客户公海","无意向公海"],btnAlign:"c"},function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:0},function(e){layer.msg("转移成功"),layer.close(a),t.btn_checkAll(),t.list_Get(1)})},function(){yocto.json(config.api_moveGh,{id:t.checks,isKhgh:1},function(e){layer.msg("转移成功"),layer.close(a),t.btn_checkAll(),t.list_Get(1)})});else layer.msg("请先选择一项进行操作")},call:function(t,e){var i=this,a=this;this.hoverEl.linkmanMobilePhone.show=0,this.hoverEl.linkmanLandline.show=0,a.loading(),top.callId="",$.post(config.api_call,{mobilePhone:e}).done(function(e){a.loading("close"),a.saleFollowMode=0,Vue.nextTick(function(){i.$refs.follow.init(t)})})},customer_detail:function(e){layer.open({type:2,title:" ",content:"customer_detail.html?id="+e.id,area:["100%","100%"]})},edit_saleRecord:function(e){var t=this;t.saleFollowMode=1,Vue.nextTick(function(){t.$refs.follow.init({id:e.id,name:e.name,h:e.type,score:e.score})})},sync:function(e){layer.open({type:2,title:"同步",closeBtn:1,content:"/saleCustomer/goZy.do?id="+e,area:["700px","600px"]})},select_init:function(e,t,i){var a;return"经理"==this.role?a="7d2f882f13ea48e0a4c8acaeea53b3a5,30b1487221464d369ca4c2462ccca920,01dc6d29f1704efeab0376d327f47d98,90564dd8b75a4f6d815ce418462d401c,e350acd05a6244c79136616302b7dfd6,b729e9334ad64c15a4e47d88b8c2638f,008615f04f39499fb73e5f323add988a,6f247fed28e94194ac66020e55957496,28f1842e2463492a9eb6ddf0def91658,73340766cf3d43af91daff3128adad84,b62d6d19bed64ee199f2c1a5b252b57b":"电销主管"==this.role&&(a="7d2f882f13ea48e0a4c8acaeea53b3a5,30b1487221464d369ca4c2462ccca920,01dc6d29f1704efeab0376d327f47d98"),$(e).select2({placeholder:t||"请选择",language:"zh-CN",allowClear:i||!1,ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(e){return{page:e.page||1,ROLE_ID:a,data:{q:e.term||""}}},processResults:function(e,t){return t.page=t.page||1,$.each(e,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:e,pagination:{more:10==e.length}}},cache:!0},minimumInputLength:0})}}})}),window.parentFnc=function(e){layer.closeAll(),window.app.list_Get()};