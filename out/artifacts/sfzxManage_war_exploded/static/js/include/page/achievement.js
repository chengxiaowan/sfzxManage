"use strict";var config={isKhGh:yo.getQueryString("isKhGh")||0,role:localStorage.userRole,api_yjzb:"/yjzb/addYjzb",api_showSaleCustomer:"/yjzb/showYjzbList",api_del:"/yjzb/deleteYjzb",api_jxxz:"/yjzb/addJxxz",api_yjxzList:"/yjzb/showYjxzList",api_deleteyjxz:"/yjzb/deleteYjxz",htz_gw:[],api_money:"/yjzb/showXzDetail",api_del_other:"/yjzb/deleteById",api_addOrUpdate:"/yjzb/addOrUpdateDxandTs",api_showRoleListByFdzb:"/yjzb/showRoleListByFdzb",api_addOrUpdateTcgz:"/yjzb/addOrUpdateTcgz",api_tcgzList:"/yjzb/showTcgzList",api_deleteTcgzById:"/yjzb/deleteTcgzById",api_tcgzDetail:"/yjzb/findById",api_dkje:"/yjzb/getMoneyByUserId",api_dktcgw:"/yjzb/getDktcGw?flag=0",api_dktcgw1:"/yjzb/getDktcGw?flag=1&roleId=",api_getUserInfo:"/user/getUserInfo1"};require(["dateTimeInit"]),"销售精英"!=config.role&&"经理"!=config.role||(config.isKhGh=4),require(["select2"],function(t){window.app=new Vue({el:"#app",data:{c:{list:[]},d:{list:[]},dixin:{list:[]},teshu:{list:[]},swgwList:{list:[]},dxswgwList:{list:[]},postDataswgwList:{},ind:1,role:config.role,isKhGh:config.isKhGh,type:0,postData:{},postData1:{},postData1_1:{},postData1_2:{},postData2:{},postData2_1:{},postData2_2:{},postRule:{},postRule1:{},postRule2:{},postDktc:{},postDktc1:{},postDktc2:{},postdxswgw:{},rule:{ruleName:"",ruleList:"",ruleBracket:"",ruleBonus:"",ruleJob:"",job:[],list:[],ruleBracket1:"",ruleJob1:"",job1:[],list1:[],ruleBracket2:"",ruleJob2:"",job2:[]},dxswgw:{ruleName:"",ruleList:"",ruleBracket:"",ruleBonus:"",ruleJob:"",job:[],list:[],ruleBracket1:"",ruleJob1:"",job1:[],list1:[],ruleBracket2:"",ruleJob2:"",job2:[]},checkAll:0,checks:[],posting:!1,hoverParam:"",editParam:"",oldData:"",s:{lastSaleName:{},lastSaleName1:{},lastSaleName2:{},lastSaleName3:{},name:"",gwName:"",dkName:"",job:[],jobName:[]},select2:{saleId:{}},saleFollowMode:1,htz_gw:[],UserInfo:[],htz_tczb:!0,htz_table:{dhl:!1,khs:!1,zg:!1,qdl:!1,bfl:!1,fdzb:[],tc:[]},jobName:"提成岗位",kind:"",hoverEl:{name:{show:0,el:{}},linkmanLandline:{show:0,el:{}},linkmanMobilePhone:{show:0,el:{}},email:{},postion:{show:0,el:{}},linkmanName:{show:0,el:{}},remark:{show:0,el:{}}},editEl:{show:"",el:{},oldValue:""},newYear:"",aType:"",newYear1:"",newYear2:""},watch:{"rule.ruleJob1":function(t){""!=t&&$.get(config.api_dkje,{userId:t},function(t){$(".dkje").val(t.result.targetDetail)}),$(".dkje").val("0")}},computed:{},created:function(){document.getElementById("app").classList.remove("hide")},mounted:function(){var a=this;a.getUserInfo(),a.newYear=a.FiscalYear(),a.newYear1=a.FiscalYear(),this.list_Get(),laydate.render({elem:"#newYear",type:"year",done:function(t,e){a.newYear=t}}),laydate.render({elem:"#newYear1",type:"year",done:function(t,e){a.newYear1=t}}),laydate.render({elem:"#newYear2",type:"year",done:function(t,e){a.newYear2=t}}),laydate.render({elem:"#year",type:"year",done:function(t,e){a.year=t}})},directives:{focus:{inserted:function(t){t.focus()}}},methods:{getUserInfo:function(){var e=this;$.get(config.api_getUserInfo,{page:"",ROLE_ID:"",data:{q:""}},function(t){e.UserInfo=t})},reset:function(){this.s.lastSaleName.val(null).trigger("change")},reset1:function(){this.s.lastSaleName1.val(null).trigger("change")},addAchievement:function(){var a=this;$("#year").val(""),$("#achievementType").val("0");var l=layer.open({type:1,title:"新增业绩指标",closeBtn:1,content:$("#achievementBox"),area:["480px","220px"],btn:"确定",btnAlign:"c",yes:function(){var t=$("#year").val(),e=$("#achievementType  option:selected").val();a.postData.year=t,a.postData.type=e,""!=t?$.get(config.api_yjzb,a.postData,function(t){"00"==t.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get()):layer.msg(t.msg)}):layer.msg("请选择年度")}})},customer_edit:function(t){var e;if(0==t.type?e="电销电话量指标":1==t.type?e="电销意向客户数指标":2==t.type?e="商务顾问到款任务指标":3==t.type?e="商务顾问合同数量指标":4==t.type?e="商务顾问订单金额指标":5==t.type?e="商务顾问拜访量指标":6==t.type?e="运作到款任务":7==t.type?e="商务顾问辞退待定指标":8==t.type?e="电销商务顾问客户约访数":9==t.type?e="电销商务顾问客户签约数":10==t.type&&(e="电销商务顾问订单标的金额"),2==t.type||3==t.type||4==t.type||5==t.type)var a=layer.open({type:2,title:t.year+"年度"+e,closeBtn:1,content:"achievement_swgw.html?id="+t.id+"&type="+t.type+"&index="+a+"&year="+t.year+"&name="+e,area:["100%","100%"]});else a=layer.open({type:2,title:t.year+"年度"+e,closeBtn:1,content:"achievement_edit.html?id="+t.id+"&type="+t.type+"&index="+a,area:["100%","100%"]})},del:function(t){var e=this,a=layer.confirm("删除该业绩指标后，该业绩指标的考核方案同样删除，是否确定删除该业绩指标?",{title:"提示"},function(){$.get(config.api_del,{parentId:t},function(t){"00"==t.error?(layer.close(a),layer.msg("删除成功"),e.list_Get()):layer.msg(t.msg)})})},s1:function(){var a=this;$("#newYear2").val(""),$("#h1").val("0");var l=layer.open({type:1,title:"新增商务顾问提成规则设置",closeBtn:1,content:$("#s1"),area:["480px","220px"],btn:"确定",btnAlign:"c",yes:function(){var t=$("#newYear2").val(),e=$(".hello  option:selected").val();a.postData.year=t,a.postData.type=e,""!=t?$.get(config.api_yjzb,a.postData,function(t){"00"==t.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_GetSwgw()):layer.msg(t.msg)}):layer.msg("请选择年度")}})},del_sw:function(t){var e=this,a=layer.confirm("删除该提成规则，员工不再享有提成，是否确定删除该提成规则?",{title:"提示"},function(){$.get(config.api_del,{parentId:t},function(t){"00"==t.error?(layer.close(a),layer.msg("删除成功"),e.list_GetSwgw()):layer.msg(t.msg)})})},customer_editSw:function(t){var e;11==t.type?e="拜访量":12==t.type&&(e="签单量");var a=layer.open({type:2,title:t.year+"年度"+e,closeBtn:1,content:"achievementsw_edit.html?id="+t.id+"&type="+t.type+"&index="+a,area:["100%","100%"]})},addSalary:function(){var a=this;$("#salaryType").val("0"),$("#salaryName").val("");var l=layer.open({type:1,title:"新增绩效薪资",closeBtn:1,content:$("#salaryBox"),area:["480px","220px"],btn:"确定",btnAlign:"c",yes:function(){var t=$("#salaryType  option:selected").val(),e=$("#salaryName").val();a.postData.name=e,a.postData.type=t,""!=e?$.get(config.api_jxxz,a.postData,function(t){"00"==t.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get1()):layer.msg(t.msg)}):layer.msg("请输入绩效名称")}})},del_xz:function(t){var e=this,a=layer.confirm("删除该绩效薪资后，员工后续将不会享受到该绩效薪资提成，是否确定删除该绩效薪资?",{title:"提示"},function(){$.get(config.api_deleteyjxz,{parentId:t},function(t){"00"==t.error?(layer.close(a),layer.msg("删除成功"),e.list_Get1()):layer.msg(t.msg)})})},del_other:function(t){var e=this,a=layer.confirm("删除该员工的底薪后，该员工不再享有基础薪资，是否确定删除该员工的底薪?",{title:"提示"},function(){$.get(config.api_del_other,{id:t},function(t){"00"==t.error?(layer.close(a),layer.msg("删除成功"),e.list_Get2()):layer.msg(t.msg)})})},del_other1:function(t){var e=this,a=layer.confirm("删除该员工的提成比例后，该员工对应的订单后续有到款也不再会有相应的提成，是否确定删除该员工的提成？?",{title:"提示"},function(){$.get(config.api_del_other,{id:t},function(t){"00"==t.error?(layer.close(a),layer.msg("删除成功"),e.list_Get3()):layer.msg(t.msg)})})},deltc:function(t,e){var a=this,l=layer.confirm("删除该提成规则，员工不再享有提成，是否确定删除该提成规则?",{title:"提示"},function(){$.get(config.api_deleteTcgzById,{id:t},function(t){"00"==t.error?(layer.close(l),layer.msg("删除成功"),3==e?a.list_Get4():5==e?a.list_Getdxswgw():a.list_Get5()):layer.msg(t.msg)})})},Salary_edit:function(t){var e;0==t.type?e="电销绩效薪资":1==t.type?e="团队管理绩效薪资":2==t.type&&(e="商务顾问浮动薪资");layer.open({type:2,title:e,closeBtn:1,content:"achievement_jxxz.html?id="+t.id+"&type="+t.type,area:["100%","100%"]})},adddixin:function(){var a=this;this.s.lastSaleName.val(null).trigger("change"),$(".yggw").val(""),$("#dixin").val("");var l=layer.open({type:1,title:"新增底薪",closeBtn:1,content:$("#dixinBox"),area:["480px","270px"],btn:"确定",btnAlign:"c",yes:function(){var t=$("#salechange").val(),e=$("#dixin").val();a.postData1.userId=t,a.postData1.targetDetail=e,a.postData1.flag=1,""!=t?""!=e?$.get(config.api_addOrUpdate,a.postData1,function(t){"00"==t.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.postData1.userId="",a.postData1.targetDetail="",a.list_Get2()):"01"==t.error?layer.msg("该员工的底薪已存在"):layer.msg(t.msg)}):layer.msg("请输入底薪"):layer.msg("请选择员工")}})},dixi_edit:function(e){var a=this;$(".xgsale").val(e.name),$(".xgsaleJob").val(e.roleName),$("#xgdixin").val(e.targetDetail);var l=layer.open({type:1,title:"新增底薪",closeBtn:1,content:$("#xgdixinBox"),area:["480px","270px"],btn:"确定",btnAlign:"c",yes:function(){var t=$("#xgdixin").val();a.postData1_1.id=e.id,""!=(a.postData1_1.targetDetail=t)?$.get(config.api_addOrUpdate,a.postData1_1,function(t){"00"==t.error?(layer.close(l),layer.msg("修改成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get2()):layer.msg(t.msg)}):layer.msg("请输入底薪")}})},addteshu:function(){var a=this;this.s.lastSaleName1.val(null).trigger("change"),$(".tsyggw").val(""),$("#tcbl").val("");var l=layer.open({type:1,title:"新增特殊员工提成",closeBtn:1,content:$("#teshuBox"),area:["480px","270px"],btn:"确定",btnAlign:"c",yes:function(){var t=$("#tssalechange").val(),e=$("#tcbl").val();a.postData2.userId=t,a.postData2.targetDetail=e,a.postData2.flag=2,""!=t?""!=e?$.get(config.api_addOrUpdate,a.postData2,function(t){"00"==t.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.postData2.userId="",a.postData2.targetDetail="",a.list_Get3()):"01"==t.error?layer.msg("该员工的提成比例已存在"):layer.msg(t.msg)}):layer.msg("请输入提成比例"):layer.msg("请选择员工")}})},teshu_edit:function(e){var a=this;$(".xgsale1").val(e.name),$(".xgsaleJob1").val(e.roleName),$("#xgdixin1").val(e.targetDetail);var l=layer.open({type:1,title:"修改特殊员工提成",closeBtn:1,content:$("#xgdixinBox1"),area:["480px","290px"],btn:"确定",btnAlign:"c",yes:function(){var t=$("#xgdixin1").val();a.postData2_1.id=e.id,""!=(a.postData2_1.targetDetail=t)?$.get(config.api_addOrUpdate,a.postData2_1,function(t){"00"==t.error?(layer.close(l),layer.msg("修改成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get3()):layer.msg(t.msg)}):layer.msg("请输入提成比例")}})},loading:function(t){"close"==t?layer.close(this.loadingSwitch):this.loadingSwitch=layer.load(3)},tab:function(t){var e=this;1==t&&e.list_Get(),2==t&&e.list_Get1(),3==t&&e.list_Get4(),4==t&&(e.list_Get5(),e.dkjob(),$("select[name=saleName]").val("")),5==t&&(this.s.gwName="",this.s.dkName="",e.list_Get2(),e.kind="",this.changeSale(),this.s.lastSaleName=this.select_init("[name=saleName]","请选择员工",e.kind,1)),6==t&&(e.list_Get3(),e.kind="fbe6f2f9535c4fce9f024f6cb999b2bd",this.s.lastSaleName1=this.select_init("[name=saleName1]","请选择员工",e.kind,1)),7==t&&e.list_Getdxswgw(),8==t&&e.list_GetSwgw()},search:function(){this.postData1_2.userId=$(".searchName_1").val(),this.list_Get2()},search1:function(){this.postData2_2.userId=$("#searchName1").val(),this.list_Get3()},searchDk:function(){this.postDktc.roleId=this.s.gwName,this.postDktc.userId=this.s.dkName,this.list_Get5()},dSearch:function(){this.list_Get()},dSearch1:function(){this.list_GetSwgw()},list_Get:function(){var e=this;e.postData.flag=0,e.postData.year=e.newYear,e.postData.type=e.aType,e.loading(),$.ajax({url:config.api_showSaleCustomer,data:e.postData}).done(function(t){e.c.list=t.result,e.loading("close")})},list_Get1:function(){var e=this;e.loading(),$.ajax({url:config.api_yjxzList,data:e.postData}).done(function(t){e.d.list=t.result,e.loading("close")})},list_Get2:function(){var e=this;e.loading(),e.postData1_2.flag=1,$.ajax({url:config.api_money,data:e.postData1_2}).done(function(t){e.dixin.list=t.result,e.loading("close")})},list_Get3:function(){var e=this;e.loading(),e.postData2_2.flag=2,$.ajax({url:config.api_money,data:e.postData2_2}).done(function(t){e.teshu.list=t.result,e.loading("close")})},list_Get4:function(){var e=this;e.loading(),$.ajax({url:config.api_tcgzList,data:{flag:0}}).done(function(t){e.rule.list=t.result,e.loading("close")})},list_Get5:function(){var e=this;e.postDktc.flag=1,e.loading(),$.ajax({url:config.api_tcgzList,data:e.postDktc}).done(function(t){e.rule.list1=t.result,e.loading("close")})},list_GetSwgw:function(){var e=this;e.postDataswgwList.flag=1,e.postDataswgwList.year=e.newYear1,e.loading(),$.ajax({url:config.api_showSaleCustomer,data:e.postDataswgwList}).done(function(t){e.swgwList.list=t.result,e.loading("close")})},list_Getdxswgw:function(){var e=this;e.loading(),$.ajax({url:config.api_tcgzList,data:{flag:2}}).done(function(t){e.dxswgwList.list=t.result,e.loading("close")})},select_init:function(t,e,a,l,n){return $(t).select2({placeholder:e||"请选择",language:"zh-CN",allowClear:l||!1,ajax:{url:"/user/getUserInfo",dataType:"json",type:"post",delay:250,data:function(t){return{page:t.page||1,ROLE_ID:n||a,data:{q:t.term||""}}},processResults:function(t,e){return e.page=e.page||1,config.htz_gw=t,$.each(t,function(){this.id=this.USER_ID,this.text=this.NAME}),{results:t,pagination:{more:10==t.length}}},cache:!0},minimumInputLength:0})},dkjob:function(){var e=this;$.get(config.api_dktcgw,{},function(t){e.s.job=t.result})},gwName:function(){var e=this,t=e.s.gwName;""!=t?$.get(config.api_dktcgw1+t,{},function(t){e.s.jobName=t.result}):(e.s.dkName="",e.s.jobName=[])},changeSale:function(){var a=this;$("#salechange").on("change",function(){for(var t=$(this).val(),e=0;e<a.UserInfo.length;e++)a.UserInfo[e].USER_ID==t&&$(".yggw").val(a.UserInfo[e].ROLE_NAME)}),$("#tssalechange").on("change",function(){for(var t=$(this).val(),e=0;e<a.UserInfo.length;e++)a.UserInfo[e].USER_ID==t&&(console.log(a.UserInfo[e].USER_ID,t),$(".tsyggw").val(a.UserInfo[e].ROLE_NAME))})},addRule:function(){var a=this;a.rule.ruleName="",a.rule.ruleList="",a.rule.ruleBracket="",a.rule.ruleBonus="",a.rule.ruleJob="",a.htz_table.dhl=!1,a.htz_table.khs=!1,a.htz_table.zg=!1,a.htz_table.qdl=!1,a.htz_table.bfl=!1;var l=layer.open({type:1,title:"新增电销提成规则",closeBtn:1,content:$("#ruleBox"),area:["850px","600px"],btn:"确定",btnAlign:"c",yes:function(){a.postRule.name=a.rule.ruleName,a.postRule.tcStandard=a.rule.ruleList,a.postRule.fdStandard=a.rule.ruleBracket,a.postRule.yjStandard=a.rule.ruleBonus,a.postRule.roleId=a.rule.ruleJob;var n,s=[];if($(".aaa td:not(:last-child)").each(function(){$(this).find(".a1").each(function(){var t={};t.fdzb=$(this).val(),s.push(t)});for(var t=$(this).find(".a2"),e=0;e<t.length;e++)if(n=$(".aaa td .a2").eq(e).val(),e<2)s[e].tc=n;else{var a=$(".aaa td .a2").eq(2).val(),l=$(".aaa td .a2").eq(3).val();s[2].tc=a+","+l}}),a.postRule.yjtcList=s,""!=a.postRule.name)if(""!=a.postRule.fdStandard)if(""!=a.postRule.yjStandard||1!=a.htz_tczb)if(""!=a.postRule.roleId){for(var t=$(".aaa input"),e=0;e<t.length;e++)if(""==t[e].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,a.postRule,function(t){"00"==t.error?(layer.close(l),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get4()):"01"==t.error&&layer.msg(t.msg)})}else layer.msg("请选择岗位");else layer.msg("请选择提成指标");else layer.msg("请选择分档指标");else layer.msg("请输入规则名称")}})},changeRule:function(){var e=this;(e.rule.ruleJob="")!=e.rule.ruleBracket?(3==e.rule.ruleBracket||4==e.rule.ruleBracket?(e.htz_tczb=!1,e.jobName="提成部门"):(e.htz_tczb=!0,e.jobName="提成岗位"),0==e.rule.ruleBracket?e.htz_table.dhl=!0:e.htz_table.dhl=!1,1==e.rule.ruleBracket?e.htz_table.khs=!0:e.htz_table.khs=!1,2==e.rule.ruleBracket?e.htz_table.zg=!0:e.htz_table.zg=!1,3==e.rule.ruleBracket?e.htz_table.qdl=!0:e.htz_table.qdl=!1,4==e.rule.ruleBracket?e.htz_table.bfl=!0:e.htz_table.bfl=!1,$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:e.rule.ruleBracket}}).done(function(t){e.rule.job=t.result})):e.rule.ruleJob=""},xg_tc:function(a){var l=this;$.get(config.api_tcgzDetail,{id:a.id,flag:0},function(t){var i=t.result;l.rule.ruleName=i.name,l.rule.ruleList=i.tcStandard,l.rule.ruleBracket=i.fdStandard,null==i.yjStandard?(l.htz_tczb=!1,l.jobName="提成部门"):(l.htz_tczb=!0,l.jobName="提成岗位",l.rule.ruleBonus=i.yjStandard),0==i.fdStandard?l.htz_table.dhl=!0:l.htz_table.dhl=!1,1==i.fdStandard?l.htz_table.khs=!0:l.htz_table.khs=!1,2==i.fdStandard?l.htz_table.zg=!0:l.htz_table.zg=!1,3==i.fdStandard?l.htz_table.qdl=!0:l.htz_table.qdl=!1,4==i.fdStandard?l.htz_table.bfl=!0:l.htz_table.bfl=!1,setTimeout(function(){for(var r=0;r<i.yjtcList.length;r++)$(".aaa td:not(:last-child)").each(function(){for(var t=$(this).find(".a1"),e=0;e<t.length;e++)$(".aaa td .a1").eq(e).val(i.yjtcList[e].fdzb);for(var a=$(this).find(".a2"),l=0;l<a.length;l++)if(2<i.yjtcList.length){$(".aaa td .a2").eq(0).val(i.yjtcList[0].tc),$(".aaa td .a2").eq(1).val(i.yjtcList[1].tc);for(var n=i.yjtcList[2].tc.split(","),s=0;s<n.length;s++)$(".aaa td .a2").eq(2).val(n[0]),$(".aaa td .a2").eq(3).val(n[1])}else $(".aaa td .a2").eq(r).val(i.yjtcList[r].tc)})},100),$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:l.rule.ruleBracket}}).done(function(t){l.rule.job=t.result,l.rule.ruleJob=i.roleId})});var n=layer.open({type:1,title:"修改电销提成规则",closeBtn:1,content:$("#ruleBox"),area:["850px","600px"],btn:"保存",btnAlign:"c",yes:function(){l.postRule.name=l.rule.ruleName,l.postRule.tcStandard=l.rule.ruleList,l.postRule.fdStandard=l.rule.ruleBracket,l.postRule.yjStandard=l.rule.ruleBonus,l.postRule.roleId=l.rule.ruleJob,l.postRule.id=a.id;var s=[];if($(".aaa td:not(:last-child)").each(function(){$(this).find(".a1").each(function(){var t={};t.fdzb=$(this).val(),s.push(t)});for(var t=$(this).find(".a2"),e=0;e<t.length;e++){var a=$(".aaa td .a2").eq(e).val();if(e<2)s[e].tc=a;else{console.log("进入");var l=$(".aaa td .a2").eq(2).val(),n=$(".aaa td .a2").eq(3).val();s[2].tc=l+","+n}}}),l.postRule.yjtcList=s,console.log(l.postRule.tcStandard),""!=l.postRule.name)if(l.postRule.fdStandard<0)layer.msg("请选择分档指标");else if(l.postRule.yjStandard<0&&1==l.htz_tczb)layer.msg("请选择提成指标");else if(l.postRule.roleId<0)layer.msg("请选择岗位");else{for(var t=$(".aaa input"),e=0;e<t.length;e++)if(""==t[e].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,l.postRule,function(t){"00"==t.error?(layer.close(n),layer.msg("修改成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),l.list_Get4()):layer.msg(t.msg)})}else layer.msg("请输入规则名称")}})},s2:function(){var r=this;$(".cancel_dom1 ").remove(),$(".ymd1_a").val("0"),$(".ymd2_a").val(""),$(".ymd3_a").val(""),r.dxswgw.ruleName="",r.dxswgw.ruleList="",r.dxswgw.ruleBracket="",r.dxswgw.ruleJob="";var i=layer.open({type:1,title:"新增电销商务顾问提成规则",closeBtn:1,content:$("#s2"),area:["850px","500px"],btn:"确定",btnAlign:"c",yes:function(){r.postdxswgw.name=r.dxswgw.ruleName,r.postdxswgw.tcStandard=r.dxswgw.ruleList,r.postdxswgw.fdStandard=r.dxswgw.ruleBracket,r.postdxswgw.roleId="90564dd8b75a4f6d815ce418462d401c";var n,s=[];if(9==r.dxswgw.ruleBracket?$(".stt .htz-td:not(:last-child)").each(function(){$(this).find("tr").each(function(){var t,e,a={};$(this).find(".a1").first().each(function(){t=$(this).val()}),$(this).find(".a1").last().each(function(){e=$(this).val(),a.fdzb=t+","+e,s.push(a)})});for(var t=$(this).find(".a2"),e=0;e<t.length;e++){var a=$(".stt td .a2").eq(e).val();s[e].tc=a}}):$(".eee td:not(:last-child)").each(function(){$(this).find(".a1").each(function(){var t={};t.fdzb=$(this).val(),s.push(t)});for(var t=$(this).find(".a2"),e=0;e<t.length;e++)if(n=$(".eee td .a2").eq(e).val(),e<2)s[e].tc=n;else{var a=$(".eee td .a2").eq(2).val(),l=$(".eee td .a2").eq(3).val();s[2].tc=a+","+l}}),r.postdxswgw.yjtcList=s,""!=r.postdxswgw.name)if(""!=r.postdxswgw.fdStandard){if(9==r.dxswgw.ruleBracket){$(".hx1_a input");for(var t=$(".hx2_a input"),e=0;e<t.length;e++)if(""==t[e].value)return void layer.msg("请填写提成系数")}else for(var a=$(".aaa input"),l=0;l<a.length;l++)if(""==a[l].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,r.postdxswgw,function(t){"00"==t.error?(layer.close(i),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),r.list_Getdxswgw()):"01"==t.error&&layer.msg(t.msg)})}else layer.msg("请选择分档指标");else layer.msg("请输入规则名称")}})},changedxswgw:function(){var t=this;7==t.dxswgw.ruleBracket?t.dxswgw.a=!0:t.dxswgw.a=!1,8==t.dxswgw.ruleBracket?t.dxswgw.b=!0:t.dxswgw.b=!1,9==t.dxswgw.ruleBracket?t.dxswgw.c=!0:t.dxswgw.c=!1},xg_dxswgwtc:function(n){var u=this;$(".cancel_dom1 ").remove(),$.get(config.api_tcgzDetail,{id:n.id,flag:0},function(t){var i=t.result;if(u.dxswgw.ruleName=i.name,u.dxswgw.ruleList=i.tcStandard,u.dxswgw.ruleBracket=i.fdStandard,7==i.fdStandard?u.dxswgw.a=!0:u.dxswgw.a=!1,8==i.fdStandard?u.dxswgw.b=!0:u.dxswgw.b=!1,9==i.fdStandard){var e,r;u.dxswgw.c=!0;var o,c=[],d=[];e+='<tr class="cancel_dom1">',e+="<td>",e+='<input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/>',e+='<span class=" htz-label pull-left" style="margin-top: 12px;width: 10%;">&le;</span>',e+='<span class=" pull-left" style="margin-top: 12px;display: block;width: 10%; text-align: center;line-height: 34px;">X</span>',e+='<span class=" htz-label pull-left" style="margin-top: 12px; width: 10%;">&lt;</span>',e+='<input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/></td></tr>';for(var a=0;a<t.result.yjtcList.length;a++)1<=a&&($(".xinzeng_a").append(e),$(".xinzeng1_a").append('<input type="number" class="cancel_dom1 form-control htz-select a2" />')),r=t.result.yjtcList;$(".stt .htz-td:not(:last-child)").each(function(){var t=$(this).find("tr");console.log(t.length);for(var e=$(this).find("tr"),a=0;a<e.length;a++){c=r[a].fdzb.split(","),o=$(this).find("tr .a1"),d.push(c);for(var l=0;l<o.length;l++)t.eq(a).find(".a1:first-child").val(d[a][0]),t.eq(a).find(".a1:last-child").val(d[a][1])}for(var n=$(this).find(".a2"),s=0;s<n.length;s++)$(".stt td .a2").eq(s).val(r[s].tc)})}else u.dxswgw.c=!1,setTimeout(function(){for(var r=0;r<i.yjtcList.length;r++)$(".eee td:not(:last-child)").each(function(){for(var t=$(this).find(".a1"),e=0;e<t.length;e++)$(".eee td .a1").eq(e).val(i.yjtcList[e].fdzb);for(var a=$(this).find(".a2"),l=0;l<a.length;l++)if(2<i.yjtcList.length){$(".eee td .a2").eq(0).val(i.yjtcList[0].tc),$(".eee td .a2").eq(1).val(i.yjtcList[1].tc);for(var n=i.yjtcList[2].tc.split(","),s=0;s<n.length;s++)$(".eee td .a2").eq(2).val(n[0]),$(".eee td .a2").eq(3).val(n[1])}else $(".eee td .a2").eq(r).val(i.yjtcList[r].tc)})},100)});var r=layer.open({type:1,title:"修改电销商务顾问提成规则",closeBtn:1,content:$("#s2"),area:["850px","550px"],btn:"保存",btnAlign:"c",yes:function(){u.postdxswgw.name=u.dxswgw.ruleName,u.postdxswgw.tcStandard=u.dxswgw.ruleList,u.postdxswgw.fdStandard=u.dxswgw.ruleBracket,u.postdxswgw.roleId="90564dd8b75a4f6d815ce418462d401c",u.postdxswgw.id=n.id;var s=[];if(9==u.dxswgw.ruleBracket?$(".stt .htz-td:not(:last-child)").each(function(){$(this).find("tr").each(function(){var t,e,a={};$(this).find(".a1").first().each(function(){t=$(this).val()}),$(this).find(".a1").last().each(function(){e=$(this).val(),a.fdzb=t+","+e,s.push(a)})});for(var t=$(this).find(".a2"),e=0;e<t.length;e++){var a=$(".stt td .a2").eq(e).val();s[e].tc=a}}):$(".eee td:not(:last-child)").each(function(){$(this).find(".a1").each(function(){var t={};t.fdzb=$(this).val(),s.push(t)});for(var t=$(this).find(".a2"),e=0;e<t.length;e++){var a=$(".eee td .a2").eq(e).val();if(e<2)s[e].tc=a;else{console.log("进入");var l=$(".eee td .a2").eq(2).val(),n=$(".eee td .a2").eq(3).val();s[2].tc=l+","+n}}}),u.postdxswgw.yjtcList=s,""!=u.postdxswgw.name)if(u.postdxswgw.fdStandard<0)layer.msg("请选择分档指标");else{if(9==u.dxswgw.ruleBracket){$(".hx1_a input");for(var t=$(".hx2_a input"),e=0;e<t.length;e++)if(""==t[e].value)return void layer.msg("请填写提成系数")}else for(var a=$(".eee input"),l=0;l<a.length;l++)if(""==a[l].value)return void layer.msg("请填写规则");yocto.json(config.api_addOrUpdateTcgz,u.postdxswgw,function(t){"00"==t.error?(layer.close(r),layer.msg("修改成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),u.list_Getdxswgw()):layer.msg(t.msg)})}else layer.msg("请输入规则名称")}})},adddk:function(){$(".cancel_dom ").remove(),$(".ymd1").val("0"),$(".ymd2").val(""),$(".ymd3").val("");var a=this;a.rule.ruleBracket1="",a.rule.ruleJob1="";var n=layer.open({type:1,title:"新增到款提成",closeBtn:1,content:$("#daokuanBox"),area:["850px","400px"],btn:"确定",btnAlign:"c",yes:function(){a.postDktc1.fdStandard=a.rule.ruleBracket1,a.postDktc1.roleId=a.rule.ruleJob1;var l=[];if($(".bbb .htz-td:not(:last-child)").each(function(){$(this).find("tr").each(function(){var t,e,a={};$(this).find(".a1").first().each(function(){t=$(this).val()}),$(this).find(".a1").last().each(function(){e=$(this).val(),a.fdzb=t+","+e,l.push(a)})});for(var t=$(this).find(".a2"),e=0;e<t.length;e++){var a=$(".bbb td .a2").eq(e).val();l[e].tc=a}}),a.postDktc1.yjtcList=l,""!=a.postDktc1.fdStandard)if(""!=a.postDktc1.roleId){$(".hx1 input");for(var t=$(".hx2 input"),e=0;e<t.length;e++)if(""==t[e].value)return void layer.msg("请填写提成比例");$.ajax({url:config.api_addOrUpdateTcgz,type:"POST",contentType:"application/json",data:JSON.stringify(a.postDktc1)}).done(function(t){"00"==t.error?(layer.close(n),layer.msg("添加成功"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),a.list_Get5()):"01"==t.error&&layer.msg("该员工到款提成已存在")})}else layer.msg("请选择员工");else layer.msg("请输入分档指标")}})},changeRule1:function(){var e=this;e.rule.ruleJob1="",e.rule.job1=[],""!=e.rule.ruleBracket1?$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:e.rule.ruleBracket1}}).done(function(t){e.rule.job1=t.result}):e.rule.ruleJob1=""},changeRule2:function(){var e=this;e.rule.ruleJob2="",e.rule.job2=[],""!=e.rule.ruleBracket2?$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:e.rule.ruleBracket2}}).done(function(t){e.rule.job2=t.result}):e.rule.ruleJob2=""},xinzen:function(){this.ind+=1;$(".xinzeng").append('<tr class="cancel_dom"><td><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/><span class=" htz-label pull-left" style="margin-top: 12px;width: 10%;">&le;</span><span class=" pull-left" style="margin-top: 12px;display: block;width: 10%; text-align: center;line-height: 34px;">X</span><span class=" htz-label pull-left" style="margin-top: 12px; width: 10%;">&lt;</span><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/></td></tr>'),$(".xinzeng1").append('<input type="number" class="cancel_dom form-control htz-select a2" />')},xinzen1:function(){$(".xinzeng_a").append('<tr class="cancel_dom1"><td><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/><span class=" htz-label pull-left" style="margin-top: 12px;width: 10%;">&le;</span><span class=" pull-left" style="margin-top: 12px;display: block;width: 10%; text-align: center;line-height: 34px;">X</span><span class=" htz-label pull-left" style="margin-top: 12px; width: 10%;">&lt;</span><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/></td></tr>'),$(".xinzeng1_a").append('<input type="number" class="cancel_dom1 form-control htz-select a2" />')},xg_dk:function(n){var s=this;$(".cancel_dom ").remove(),$.get(config.api_tcgzDetail,{id:n.id,flag:1},function(e){s.rule.ruleBracket2=e.result.fdStandard;var r,i,o=[],c=[];for(var t=0;t<e.result.yjtcList.length;t++)1<=t&&($(".xz1").append('<tr class="cancel_dom"><td><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/><span class=" htz-label pull-left" style="margin-top: 12px;width: 10%;">&le;</span><span class=" pull-left" style="margin-top: 12px;display: block;width: 10%; text-align: center;line-height: 34px;">X</span><span class=" htz-label pull-left" style="margin-top: 12px; width: 10%;">&lt;</span><input type="number"  class=" form-control pull-left a1"  style="width: 35%;margin-top: 12px;"/></td></tr>'),$(".xz2").append('<input type="number" class="cancel_dom form-control htz-select a2" />')),r=e.result.yjtcList;$(".ccc .htz-td1:not(:last-child)").each(function(){var t=$(this).find("tr");console.log(t.length);for(var e=$(this).find("tr"),a=0;a<e.length;a++){o=r[a].fdzb.split(","),i=$(this).find("tr .a1"),c.push(o);for(var l=0;l<i.length;l++)t.eq(a).find(".a1:first-child").val(c[a][0]),t.eq(a).find(".a1:last-child").val(c[a][1])}for(var n=$(this).find(".a2"),s=0;s<n.length;s++)$(".ccc td .a2").eq(s).val(r[s].tc)}),$.ajax({url:config.api_showRoleListByFdzb,async:!1,data:{fdStandard:s.rule.ruleBracket2}}).done(function(t){s.rule.job2=t.result,s.rule.ruleJob2=e.result.userId});var a=layer.open({type:1,title:"修改到款提成",closeBtn:1,content:$("#daokuanBox1"),area:["850px","400px"],btn:"保存",btnAlign:"c",yes:function(){s.postDktc2.fdStandard=s.rule.ruleBracket2,s.postDktc2.roleId=s.rule.ruleJob2,s.postDktc2.id=n.id;var l=[];if($(".ccc .htz-td1:not(:last-child)").each(function(){$(this).find("tr").each(function(){var t,e,a={};$(this).find(".a1").first().each(function(){t=$(this).val()}),$(this).find(".a1").last().each(function(){e=$(this).val(),a.fdzb=t+","+e,l.push(a)})});for(var t=$(this).find(".a2"),e=0;e<t.length;e++){var a=$(".ccc td .a2").eq(e).val();l[e].tc=a}}),s.postDktc2.yjtcList=l,s.postDktc2.fdStandard<0)layer.msg("请输入分档指标");else if(""!=s.postDktc2.roleId){for(var t=$(".who input"),e=0;e<t.length;e++)if(""==t[e].value)return void layer.msg("请填写提成比例");$.ajax({url:config.api_addOrUpdateTcgz,type:"POST",contentType:"application/json",data:JSON.stringify(s.postDktc2)}).done(function(t){"00"==t.error?(layer.close(a),layer.msg("修改成功"),$(".cancel_dom").remove(),console.log(".cancel_dom"),setTimeout(function(){parent.app&&parent.parentFnc()},2e3),s.list_Get5()):layer.msg(t.msg)})}else layer.msg("请选择员工")},cancel:function(){console.log($(".cancel_dom")),$(".cancel_dom").remove()}})})},FiscalYear:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1;return"01"==a||"02"==a||"03"==a?Number(e)-1:e},edit_hover:function(t,e){Vue.set(this.hoverEl,t,{show:1,el:e})},edit_el:function(t,e){this.editEl.show=t,this.editEl.el=e,this.editEl.oldValue=e.name},edit_submit:function(t,e){console.log(2),this.editEl.show="",this.editEl.el={},Vue.set(this.hoverEl,t,{show:0,el:{}}),this.saveData(t,e)},edit_keyup:function(t,e){console.log(1),this.editEl.show="",this.editEl.el={},Vue.set(this.hoverEl,t,{show:0,el:{}})},saveData:function(e,a){function t(){var t={id:a.id,type:a.type};t[e]=$.trim(a[e]),$.post(config.api_jxxz,t,function(t){})}"name"!=e||""!=a.name?"name"==e&&a.name==this.editEl.oldValue||t():a.name=this.editEl.oldValue}}})}),window.parentFnc=function(t){layer.closeAll(),window.app.getCaseRecord(window.app.type)};